
USE hocsql
CREATE TABLE QuanLyBanHang
(
MAKH CHAR(4) primary key,
HOTEN varchar(40),
DCHI varchar(50),
SODT varchar(10),
NGSINH smalldatetime,
NGDK smalldatetime,
DOANHSO money,
);

CREATE TABLE NhanVien (
MANV CHAR(4) PRIMARY KEY,
HOTEN VARCHAR(40),
SODT VARCHAR(20),
NGVL smalldatetime,
);



CREATE TABLE SANPHAM(
MASP char(4) primary key,
TENSP varchar(40),
DVT varchar(20),
NUOCSX varchar(40),
GIA money,
);

CREATE TABLE HOADON ( 
SOHD INT PRIMARY KEY,
NGHD smalldatetime,
MAKH char(4),
MANV char(4),
TRIGIA money,
);

CREATE TABLE CTHD (
SOHD INT PRIMARY KEY,
MASP char(4),
SL INT,
);

ALTER TABLE CTHD ADD
CONSTRAINT FK_CTHD_HOADON FOREIGN KEY (SOHD) REFERENCES HOADON(SOHD),
CONSTRAINT FK_CTHD_SANPHAM FOREIGN KEY (MASP) REFERENCES  SANPHAM(MASP)
;
ALTER TABLE HOADON ADD
CONSTRAINT FK_HOADON_QuanLyBanHang  FOREIGN KEY(MAKH) REFERENCES QuanLyBanHang(MAKH),
CONSTRAINT FK_HOADON_NhanVien FOREIGN KEY(MANV) REFERENCES NhanVien(MANV);
ALTER TABLE SANPHAM 
ADD GHICHU VARCHAR(20);
ALTER TABLE QuanLyBanHang
ADD LOAIKH TINYINT;
ALTER TABLE SANPHAM ALTER COLUMN GHICHU VARCHAR(100);
ALTER TABLE SANPHAM
DROP COLUMN GHICHU;

ALTER TABLE QuanLyBanHang
ADD CONSTRAINT PHANLOAI_KH CHECK (LOAIKH IN ('VANG LAI ','THUONG XUYEN','VIP'));
ALTER TABLE SANPHAM
ADD CONSTRAINT DVT_SANPHAM CHECK(DVT IN ('cay','hop','cai','quyen','chuc'));
ALTER TABLE SANPHAM
ADD CONSTRAINT CHECK_GIA CHECK (GIA >=500);
ALTER TABLE HOADON 
ADD CONSTRAINT CK_SL check (SOHD >=1);
ALTER TABLE QuanLyBanHang
ADD CONSTRAINT CK_KH CHECK (NGSINH < NGDK);

